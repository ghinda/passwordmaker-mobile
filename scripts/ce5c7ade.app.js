var app=angular.module("passwordmaker-mobile",["ngRoute","ngTouch","ngAnimate"]).config(["$routeProvider","$compileProvider",function(a,b){"use strict";a.when("/generate/:profileId?",{templateUrl:"views/generate.html",controller:"GenerateCtrl"}).when("/profile/:profileId?",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/generate"}),b.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|app):/)}]);app.run(["$rootScope","$location","$timeout","data",function(a,b,c,d){"use strict";var e=a.root={};e.profiles=d.model.profiles,a.$watch("root.profiles",function(){d.SaveProfiles()},!0),a.Go=function(a,c){e.viewTransition=c,b.path(a)},a.ClearModel=function(a,b,c){return a[b]="",c.preventDefault()}}]),app.controller("GenerateCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","$q","data",function(a,b,c,d,e,f,g){"use strict";var h=b.model={},i=a.root;h.profile={},h.copyDone=!1,c.profileId?g.GetProfile({id:1*c.profileId}).then(function(a){e(function(){h.profile=a})}).catch(function(){d.path("/generate/"+i.profiles[0].id)}):g.GetProfiles().then(function(){d.path("/generate/"+i.profiles[0].id)}),h.showProfileMenu=!1,b.ToggleProfileMenu=function(){h.showProfileMenu=!h.showProfileMenu},h.showPassword=!1,h.masterkey="",h.url="",h.generatedPassword="";var j=function(){var a={};angular.extend(a,h.profile),a.masterkey=h.masterkey,a.url=h.url,h.generatedPassword=passwordmaker.generate(a)};b.$watchCollection("[model.masterkey,model.url]",j);var k=function(){new Notification("PasswordMaker",{body:h.generatedPassword,icon:window.location.origin+"/images/icons/passwordmaker-mobile-icon-48.png"})};b.Notify=function(){"granted"===Notification.permission?k():"denied"!==Notification.permission&&Notification.requestPermission(function(a){"permission"in Notification||(Notification.permission=a),"granted"===a&&k()})},b.Copy=function(){document.querySelector(".password-generated input").select();try{document.execCommand("copy"),h.copyDone=!0,e(function(){h.copyDone=!1},2e3)}catch(a){}}}]),app.controller("ProfileCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","$q","data",function(a,b,c,d,e,f,g){"use strict";var h=b.model={};a.root;h.showConfirmDelete=!1,h.profile={},h.leetValues=[];for(var i=0;i<10;i++)h.leetValues.push({label:i});c.profileId?g.GetProfile({id:1*c.profileId}).then(function(a){angular.copy(a,h.profile)}):(angular.copy(g.model.defaultProfile,h.profile),h.profile.name="New profile"),b.SaveProfile=function(){g.SaveProfile(h.profile),a.Go("/generate/"+h.profile.id,"popdown")},b.DeleteProfile=function(){h.showConfirmDelete?(g.DeleteProfile(h.profile),a.Go("/generate","popdown")):h.showConfirmDelete=!0}}]),app.factory("data",["$rootScope","$http","$q","$timeout",function(a,b,c,d){"use strict";var e={name:"Default",url_protocol:!1,url_subdomain:!1,url_domain:!0,url_path:!1,strUseText:"",selectedCharset:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",hashAlgorithm:"md5",whereToUseL33t:"off",l33tLevel:0,username:"",modifier:"",passwordLength:8,passwordPrefix:"",passwordSuffix:""},f={defaultProfile:e,profiles:[]},g=function(a){var b=c.defer();return f.profiles.length?b.resolve(f.profiles):localforage.getItem("profiles").then(function(a){if(a&&a.length)f.profiles.length=0,[].push.apply(f.profiles,a);else{var c={};angular.copy(e,c),c.id=Date.now(),f.profiles.push(c)}b.resolve(f.profiles)}),b.promise},h=function(a){var b=c.defer(),d=function(){var c;angular.forEach(f.profiles,function(b){if(a.id===b.id)return c=b,!1}),c?b.resolve(c):b.reject()};return f.profiles.length?d():g().then(d),b.promise},i=function(a){var b=c.defer();return a.id?angular.forEach(f.profiles,function(c){if(a.id===c.id)return angular.extend(c,a),b.resolve(c),!1}):(a.id=Date.now(),f.profiles.push(a),b.resolve(a)),b.promise},j=function(a){var b=c.defer();return f.profiles.length?(localforage.setItem("profiles",f.profiles),b.resolve(f.profiles)):b.reject(),b.promise},k=function(a){var b=c.defer();return angular.forEach(f.profiles,function(c,d){if(a.id===c.id)return f.profiles.splice(d,1),b.resolve(c),!1}),b.promise};return{model:f,GetProfiles:g,SaveProfiles:j,GetProfile:h,SaveProfile:i,DeleteProfile:k}}]),angular.module("passwordmaker-mobile").run(["$templateCache",function(a){"use strict";a.put("views/generate.html",'<section role="region">\n\n  <header class="fixed">\n\n    <menu type="toolbar">\n      <a ng-click="Go(\'/profile/\' + model.profile.id, \'popup\')">\n        <span class="icon icon-compose">edit</span>\n      </a>\n    </menu>\n\n    <a ng-click="ToggleProfileMenu()">\n      <span class="icon icon-menu">show profiles</span>\n    </a>\n\n    <h1>\n      {{ model.profile.name }}\n    </h1>\n\n  </header>\n\n  <article class="scrollable header">\n\n    <form class="profile-menu" ng-show="model.showProfileMenu">\n\n      <section data-type="list" >\n        <ul>\n          <li ng-repeat="profile in root.profiles">\n\n            <a ng-click="(model.profile.id !== profile.id) ? Go(\'/generate/\' + profile.id, \'popup\') : ToggleProfileMenu()">\n              <p>\n                {{ profile.name }}\n              </p>\n            </a>\n\n          </li>\n        </ul>\n      </section>\n\n      <button ng-click="Go(\'/profile\', \'popup\')" type="button" class="recommend btn-new-profile">\n        Create profile\n      </button>\n\n    </form>\n\n    <form ng-submit="Notify()" data-type="list">\n\n      <p>\n        <input type="text" placeholder="Password" ng-model="model.masterkey" ng-if="model.showPassword">\n\n        <input type="password" placeholder="Password" ng-model="model.masterkey" ng-if="!model.showPassword">\n\n        <button type="reset" ng-click="ClearModel(model, \'masterkey\', $event)">Clear</button>\n      </p>\n\n      <p>\n        <label for="show-password">\n          Show password\n        </label>\n\n        <label class="pack-switch">\n          <input type="checkbox" id="show-password" ng-model="model.showPassword">\n          <span></span>\n        </label>\n      </p>\n\n      <p>\n        <input type="text" placeholder="Used text" ng-model="model.url">\n        <button type="reset" ng-click="ClearModel(model, \'url\', $event)">Clear</button>\n      </p>\n\n      <header>\n        Generated password:\n      </header>\n\n      <p class="password-generated">\n        <input type="text" placeholder="Used text" ng-model="model.generatedPassword" readonly>\n      </p>\n\n      <button type="submit" class="recommend">\n        Show as notification\n      </button>\n\n      <button type="button" class="recommend" ng-click="Copy()">\n'+"        {{ model.copyDone ? 'Copied' : 'Copy to clipboard' }}\n      </button>\n\n    </form>\n\n  </article>\n\n</section>\n\n"),a.put("views/profile.html",'<section role="region">\n\n  <header class="fixed">\n\n    <menu type="toolbar">\n      <a ng-click="SaveProfile()" ng-disabled="!model.profile.name || !model.profile.passwordLength">\n        Save\n      </a>\n    </menu>\n\n    <a ng-click="Go(\'/generate/\' + model.profile.id, \'popdown\')">\n      <span class="icon icon-back">back to generator</span>\n    </a>\n\n    <h1>\n      {{ model.profile.name }}\n    </h1>\n\n  </header>\n\n  <article class="scrollable header">\n\n    <form data-type="list">\n\n      <p>\n        <input type="text" placeholder="Name" ng-model="model.profile.name" required>\n        <button type="reset" ng-click="ClearModel(model.profile, \'name\', $event)">Clear</button>\n      </p>\n\n      <header>\n        URL Components\n      </header>\n\n      <p>\n        <label class="pack-checkbox">\n          <input type="checkbox" id="protocol" ng-model="model.profile.url_protocol">\n          <span></span>\n        </label>\n\n        <label for="protocol">\n          Protocol\n        </label>\n      </p>\n\n      <p>\n        <label class="pack-checkbox">\n          <input type="checkbox" id="subdomains" ng-model="model.profile.url_subdomain">\n          <span></span>\n        </label>\n\n        <label for="subdomains">\n          Subdomain(s)\n        </label>\n      </p>\n\n      <p>\n        <label class="pack-checkbox">\n          <input type="checkbox" id="domain" ng-model="model.profile.url_domain">\n          <span></span>\n        </label>\n\n        <label for="domain">\n          Domain\n        </label>\n      </p>\n\n      <p>\n        <label class="pack-checkbox">\n          <input type="checkbox" id="path" ng-model="model.profile.url_path">\n          <span></span>\n        </label>\n\n        <label for="path">\n          Port, path, query parameters\n        </label>\n      </p>\n\n      <p>\n        <input type="text" placeholder="Use this text" ng-model="model.profile.strUseText">\n        <button type="reset">Clear</button>\n      </p>\n\n      <p>\n        <small>\n          If you want to use a fixed URL every time, you can fill it here. <br>\n          E.g. To use the same password on example.com and anotherexample.com, enter example.com here and it will always uses example.com for this profile.\n        </small>\n      </p>\n\n      <header>\n        Use l33t\n      </header>\n\n      <p>\n        <select name="theme" ng-model="model.profile.whereToUseL33t">\n          <option value="off">\n            Not at all\n          </option>\n          <option value="before-hashing">\n            Before generating password\n          </option>\n          <option value="after-hashing">\n            After generating password\n          </option>\n          <option value="both">\n            Before and after generating password\n          </option>\n        </select>\n      </p>\n\n      <header>\n        l33t level\n      </header>\n\n      <p>\n        <select name="theme" ng-disabled="model.profile.whereToUseL33t === \'off\'" ng-model="model.profile.l33tLevel" ng-options="leet.label as leet.label for leet in model.leetValues">\n        </select>\n      </p>\n\n      <header>\n        Hash Algorithm\n      </header>\n\n      <p>\n        <select ng-model="model.profile.hashAlgorithm">\n          <option value="md4">MD4</option>\n          <option value="hmac-md4">HMAC-MD4</option>\n          <option value="md5">MD5</option>\n          <option value="hmac-md5">HMAC-MD5</option>\n          <option value="sha1">SHA-1</option>\n          <option value="hmac-sha1">HMAC-SHA-1</option>\n          <option value="sha256">SHA-256</option>\n          <option value="hmac-sha256_fix">HMAC-SHA-256</option>\n          <option value="rmd160">RIPEMD-160</option>\n          <option value="hmac-rmd160">HMAC-RIPEMD-160</option>\n        </select>\n      </p>\n\n      <p>\n        <input type="number" placeholder="Password Length" ng-model="model.profile.passwordLength" required>\n        <button type="reset" ng-click="ClearModel(model.profile, \'passwordLength\', $event)">Clear</button>\n      </p>\n\n      <p>\n        <input type="text" placeholder="Username" ng-model="model.profile.username">\n        <button type="reset" ng-click="ClearModel(model.profile, \'username\', $event)">Clear</button>\n      </p>\n\n      <p>\n        <input type="text" placeholder="Modifier" ng-model="model.profile.modifier">\n        <button type="reset" ng-click="ClearModel(model.profile, \'modifier\', $event)">Clear</button>\n      </p>\n\n      <header>\n        Characters\n      </header>\n\n      <p>\n        <select ng-model="model.profile.selectedCharset">\n          <option>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`~!@#$%^&amp;*()_-+={}|[]\\:";\'&lt;&gt;?,./</option>\n          <option>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</option>\n          <option>0123456789abcdef</option>\n          <option>0123456789</option>\n          <option>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz</option>\n          <option>`~!@#$%^&amp;*()_-+={}|[]:";\'&lt;&gt;?,./</option>\n        </select>\n      </p>\n\n      <p>\n        <input type="text" placeholder="Password Prefix" ng-model="model.profile.passwordPrefix">\n        <button type="reset" ng-click="ClearModel(model.profile, \'passwordPrefix\', $event)">Clear</button>\n      </p>\n\n      <p>\n        <input type="text" placeholder="Password Suffix" ng-model="model.profile.passwordSuffix">\n        <button type="reset" ng-click="ClearModel(model.profile, \'passwordSuffix\', $event)">Clear</button>\n      </p>\n\n      <button ng-click="DeleteProfile()" type="button" class="danger" ng-if="model.profile.id && root.profiles.length > 1">\n        Delete profile\n      </button>\n\n    </form>\n\n  </article>\n\n</section>\n\n<form role="dialog" data-type="confirm" ng-show="model.showConfirmDelete" class="dialog-delete-confirm">\n  <section>\n    <h1>\n      Delete profile\n    </h1>\n    <p>Are you sure you want to delete this profile?</p>\n  </section>\n  <menu>\n    <button type="button" ng-click="model.showConfirmDelete = fale">Cancel</button>\n    <button type="button" class="danger" ng-click="DeleteProfile()">Delete</button>\n  </menu>\n</form>\n\n\n')}]);